var h="https://js.stripe.com/v3",T=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,p="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",x=function(){for(var e=document.querySelectorAll('script[src^="'.concat(h,'"]')),t=0;t<e.length;t++){var n=e[t];if(T.test(n.src))return n}return null},m=function(e){var t="",n=document.createElement("script");n.src="".concat(h).concat(t);var o=document.head||document.body;if(!o)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return o.appendChild(n),n},j=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"4.4.0",startTime:t})},s=null,d=null,u=null,B=function(e){return function(){e(new Error("Failed to load Stripe.js"))}},R=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}},C=function(e){return s!==null?s:(s=new Promise(function(t,n){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe&&e&&console.warn(p),window.Stripe){t(window.Stripe);return}try{var o=x();if(o&&e)console.warn(p);else if(!o)o=m(e);else if(o&&u!==null&&d!==null){var l;o.removeEventListener("load",u),o.removeEventListener("error",d),(l=o.parentNode)===null||l===void 0||l.removeChild(o),o=m(e)}u=R(t,n),d=B(n),o.addEventListener("load",u),o.addEventListener("error",d)}catch(I){n(I);return}}),s.catch(function(t){return s=null,Promise.reject(t)}))},D=function(e,t,n){if(e===null)return null;var o=e.apply(void 0,t);return j(o,n),o},c,E=!1,S=function(){return c||(c=C(null).catch(function(e){return c=null,Promise.reject(e)}),c)};Promise.resolve().then(function(){return S()}).catch(function(r){E||console.warn(r)});var U=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];E=!0;var o=Date.now();return S().then(function(l){return D(l,t,o)})};const i=document.getElementById("buy-button");if(!i||!i.dataset||!i.dataset.stripeKey||!i.dataset.pet1)throw console.error("You managed to break my site. Please contact the Tanner."),new Error("You managed to break my site. Please contact the Tanner.");const A=i.dataset.pet1,y=await U(i.dataset.stripeKey);if(!y)throw console.error("Stripe failed to load"),new Error("Stripe failed to load");const a=document.getElementById("petImage"),b=document.getElementById("thumbnail");a&&a.addEventListener("change",r=>{if(!a.files||a.files.length===0)throw new Error("No file selected");const e=a.files[0],t=new FileReader;t.onload=n=>{if(!n.target||!n.target.result)throw new Error("No file selected");b.src=n.target.result},t.readAsDataURL(e)});const g=document.querySelectorAll("[data-gender]");let f="unknown";g.forEach(r=>{r.addEventListener("click",()=>{g.forEach(e=>e.classList.remove("btn-active")),r.classList.add("btn-active"),f=r.dataset.gender})});const P=document.getElementById("buy-button");if(!P)throw console.error("Buy button not found"),new Error("Buy button not found");P.addEventListener("click",async()=>{if(!a.files||a.files.length===0)throw alert("Please select an image first."),new Error("Please select an image first.");const r=a.files[0],e=new FormData;e.append("image",r),e.append("gender",f);const t=await fetch("https://api.varietygiftsunlimited.com/upload-img",{method:"POST",body:e});if(t.ok){const n=await t.text();console.log("API Response:",n),y.redirectToCheckout({lineItems:[{price:A,quantity:1}],mode:"payment",successUrl:`${window.location.origin}/pet-converter?success=true&session_id={CHECKOUT_SESSION_ID}&image_id=${n}&gender=${f}`,cancelUrl:`${window.location.origin}/pet-converter?error=true`}).then(function(o){o.error&&alert(o.error.message)})}else alert("Failed to upload thumbnail image. Please try again.")});function L(r){r=r.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+r+"=([^&#]*)"),t=e.exec(location.search);return t===null?"":decodeURIComponent(t[1].replace(/\+/g," "))}const v=L("image_id");if(v){let r=new FormData;r.append("gender",L("gender")),r.append("filename",v);var F=await fetch("https://api.varietygiftsunlimited.com/pet-converter",{method:"POST",body:r}),w=await F.text().then(e=>e.replace(/^"|"$/g,""));console.log(w),b.src="https://api.varietygiftsunlimited.com/"+w}
