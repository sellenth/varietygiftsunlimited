---
import Layout from "../../../layouts/Layout.astro";
import ProductDetailEnhanced from "../../../components/ProductDetail-Enhanced.astro";
import { products, StripeProductManager } from "../../../data/products";

export function getStaticPaths() {
    return products.map(product => ({
        params: { id: product.slug },
        props: { product }
    }));
}

const { product } = Astro.props;

// Get the canonical URL for this product
const canonicalUrl = `https://varietygiftsunlimited.com/shop/product/${product.slug}`;

// Get the first image for social media preview
const ogImageUrl = product.images[0]?.src.startsWith('http') 
    ? product.images[0].src 
    : `https://varietygiftsunlimited.com${product.images[0]?.src}`;
---

<Layout 
    title={`${product.name} - Variety Gifts Unlimited`} 
    hideHeader={false}
    description={product.description}
    ogTitle={`${product.name} - ${product.price}`}
    ogDescription={product.description}
    ogImage={ogImageUrl}
    ogUrl={canonicalUrl}
>
    <script slot="head" type="application/ld+json" set:html={JSON.stringify({
        "@context": "https://schema.org/",
        "@type": "Product",
        "name": product.name,
        "image": product.images.map(img => img.src.startsWith('http') ? img.src : `https://varietygiftsunlimited.com${img.src}`),
        "description": product.description,
        "brand": {
            "@type": "Brand",
            "name": "Variety Gifts Unlimited"
        },
        "offers": {
            "@type": "Offer",
            "priceCurrency": "USD",
            "price": product.price.replace(/[^0-9.]/g, ''),
            "availability": "https://schema.org/InStock",
            "seller": {
                "@type": "Organization",
                "name": "Variety Gifts Unlimited"
            }
        }
    })} />
    
    <ProductDetailEnhanced productId={product.id} />
    
    {product.priceIds && product.colorImages && (
        <script is:inline define:vars={{ priceIds: product.priceIds, colorImages: product.colorImages }}>
            window.priceIds = priceIds;
            window.colorImages = colorImages;
        </script>
    )}
</Layout>