---
import Layout from "../../layouts/Layout.astro";
import { getCollection, type CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  const blogPosts = await getCollection('blog');
  return blogPosts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

type Props = {
  post: CollectionEntry<'blog'>;
};

const { post } = Astro.props;
const { Content } = await post.render();

// Environment-aware base URL
const isLocalhost = import.meta.env.DEV || Astro.url.hostname === "localhost";
const baseUrl = isLocalhost ? "" : "https://variety.gifts";

// SEO Keywords extracted from content and tags
const seoKeywords = [
  ...post.data.tags,
  "AI coding assistant",
  "developer tools",
  "programming productivity",
  "code automation",
  "software development"
].join(", ");

// Canonical URL
const canonicalUrl = `${baseUrl}/blog/${post.slug}`;

// Structured data for SEO
const structuredData = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": post.data.title,
  "description": post.data.excerpt,
  "author": {
    "@type": "Organization",
    "name": "Variety Gifts Unlimited"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Variety Gifts Unlimited",
    "logo": {
      "@type": "ImageObject",
      "url": `${baseUrl}/logos/new_logo.jpg`
    }
  },
  "datePublished": post.data.date,
  "dateModified": post.data.date,
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": canonicalUrl
  },
  "keywords": seoKeywords,
  "articleSection": "Technology",
  "inLanguage": "en-US"
};
---

<Layout
  title={`${post.data.title} - Variety Gifts Blog`}
  hideHeader={false}
  hideFooter={false}
  description={post.data.excerpt}
  ogTitle={post.data.title}
  ogDescription={post.data.excerpt}
  ogUrl={canonicalUrl}
  ogImage={`${baseUrl}/logos/new_logo.jpg`}
>
  <Fragment slot="head">
    <!-- Enhanced SEO Meta Tags -->
    <meta name="keywords" content={seoKeywords} />
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
    <meta name="article:published_time" content={post.data.date} />
    <meta name="article:modified_time" content={post.data.date} />
    <meta name="article:author" content="Variety Gifts Unlimited" />
    <meta name="article:section" content="Technology" />
    {post.data.tags.map(tag => (
      <meta name="article:tag" content={tag} />
    ))}
    
    <!-- Additional Twitter Cards -->
    <meta name="twitter:label1" content="Reading time" />
    <meta name="twitter:data1" content={post.data.readTime} />
    <meta name="twitter:label2" content="Written by" />
    <meta name="twitter:data2" content="Variety Gifts Team" />
    
    <!-- Canonical URL -->
    <link rel="canonical" href={canonicalUrl} />
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
  </Fragment>

  <main class="w-full overflow-x-hidden relative">
    <!-- Blog Header -->
    <section class="blog-header pt-16 px-4 sm:px-8 md:px-12 lg:px-24 py-20 bg-white">
      <div class="max-w-4xl mx-auto">
        <!-- Breadcrumb with Schema -->
        <nav class="breadcrumb mb-8" aria-label="Breadcrumb">
          <ol itemscope itemtype="https://schema.org/BreadcrumbList" class="breadcrumb-list">
            <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
              <a href={`${baseUrl}/`} itemprop="item" class="breadcrumb-link">
                <span itemprop="name">Home</span>
              </a>
              <meta itemprop="position" content="1" />
            </li>
            <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
              <a href={`${baseUrl}/blog`} itemprop="item" class="breadcrumb-link">
                <span itemprop="name">Blog</span>
              </a>
              <meta itemprop="position" content="2" />
            </li>
            <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
              <span itemprop="name" class="breadcrumb-current">{post.data.title}</span>
              <meta itemprop="position" content="3" />
            </li>
          </ol>
        </nav>
        
        <!-- Post Meta with Schema -->
        <div class="post-meta mb-6">
          <time datetime={post.data.date} class="post-date">{new Date(post.data.date).toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
          })}</time>
          <span class="post-read-time">{post.data.readTime}</span>
        </div>

        <!-- Post Title with SEO optimization -->
        <h1 class="post-title text-4xl md:text-5xl lg:text-6xl font-bold text-indigo-900 mb-6">
          {post.data.title}
        </h1>

        <!-- Post Excerpt for SEO -->
        <p class="post-excerpt text-lg md:text-xl text-indigo-800 mb-6 max-w-3xl">
          {post.data.excerpt}
        </p>

        <!-- Post Tags with SEO optimization -->
        <div class="post-tags">
          {post.data.tags.map((tag) => (
            <span class="post-tag" itemprop="keywords">{tag}</span>
          ))}
        </div>
      </div>
    </section>

    <!-- Blog Content with proper semantic HTML -->
    <section class="blog-content py-12 px-4 sm:px-8 md:px-12 lg:px-24 bg-white">
      <div class="max-w-4xl mx-auto">
        <article class="prose" itemscope itemtype="https://schema.org/BlogPosting">
          <!-- Hidden schema data -->
          <meta itemprop="headline" content={post.data.title} />
          <meta itemprop="description" content={post.data.excerpt} />
          <meta itemprop="datePublished" content={post.data.date} />
          <meta itemprop="dateModified" content={post.data.date} />
          <meta itemprop="author" content="Variety Gifts Unlimited" />
          <meta itemprop="publisher" content="Variety Gifts Unlimited" />
          
          <div itemprop="articleBody">
            <Content />
          </div>
        </article>

        <!-- Related Topics for SEO -->
        <aside class="related-topics mt-12 p-6 bg-gray-50 rounded-lg">
          <h3 class="text-xl font-bold text-indigo-900 mb-4">Related Topics</h3>
          <div class="topic-tags">
            <span class="topic-tag">AI Development Tools</span>
            <span class="topic-tag">Code Automation</span>
            <span class="topic-tag">Developer Productivity</span>
            <span class="topic-tag">Programming Assistance</span>
            <span class="topic-tag">Software Engineering</span>
          </div>
        </aside>

        <!-- Post Navigation with SEO -->
        <div class="post-navigation mt-12 pt-8 border-t border-gray-200">
          <a href={`${baseUrl}/blog`} class="back-to-blog btn-secondary" rel="up">
            ← Back to All Posts
          </a>
        </div>
      </div>
    </section>
  </main>
</Layout>

<style>
  /* Blog Header */
  .blog-header {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  }

  /* Breadcrumb */
  .breadcrumb-list {
    display: flex;
    list-style: none;
    padding: 0;
    margin: 0;
    gap: 0.5rem;
    align-items: center;
  }

  .breadcrumb-list li:not(:last-child)::after {
    content: "›";
    margin-left: 0.5rem;
    color: #9ca3af;
  }

  .breadcrumb-link {
    color: #6366f1;
    text-decoration: none;
    font-weight: 500;
    transition: color 0.3s ease;
  }

  .breadcrumb-link:hover {
    color: #3730a3;
  }

  .breadcrumb-current {
    color: #6b7280;
    font-weight: 500;
  }

  /* Post Meta */
  .post-meta {
    display: flex;
    gap: 1rem;
    align-items: center;
    font-size: 0.875rem;
  }

  .post-date {
    color: #6366f1;
    font-weight: 500;
  }

  .post-read-time {
    color: #8b5cf6;
    font-weight: 500;
  }

  .post-read-time::before {
    content: "•";
    margin-right: 0.5rem;
    color: #d1d5db;
  }

  /* Post Title */
  .post-title {
    line-height: 1.2;
  }

  /* Post Excerpt */
  .post-excerpt {
    line-height: 1.6;
  }

  /* Post Tags */
  .post-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .post-tag {
    background: rgba(99, 102, 241, 0.1);
    color: #6366f1;
    padding: 0.375rem 1rem;
    border-radius: 20px;
    font-size: 0.875rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  /* Prose Styles */
  .prose {
    max-width: none;
    color: #374151;
    line-height: 1.7;
  }

  .prose :global(p:first-of-type) {
    font-size: 1.25rem;
    color: #4b5563;
    margin-bottom: 2rem;
    font-weight: 400;
    line-height: 1.6;
  }

  .prose :global(h2) {
    color: #3730a3;
    font-size: 1.875rem;
    font-weight: bold;
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    line-height: 1.3;
  }

  .prose :global(h2:first-of-type) {
    margin-top: 1.5rem;
  }

  .prose :global(p) {
    margin-bottom: 1.5rem;
    font-size: 1.125rem;
  }

  .prose :global(ul) {
    margin: 1.5rem 0;
    padding-left: 1.5rem;
  }

  .prose :global(li) {
    margin-bottom: 0.5rem;
    font-size: 1.125rem;
  }

  .prose :global(li::marker) {
    color: #6366f1;
  }

  .prose :global(blockquote) {
    border-left: 4px solid #6366f1;
    padding-left: 1.5rem;
    margin: 2rem 0;
    font-style: italic;
    color: #4b5563;
    background: rgba(99, 102, 241, 0.05);
    padding: 1.5rem;
    border-radius: 0.5rem;
    font-size: 1.125rem;
  }

  /* Code Formatting */
  .prose :global(code) {
    background: #f1f5f9;
    color: #e11d48;
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-size: 0.875em;
    font-family: 'JetBrains Mono', 'Fira Code', 'Monaco', 'Cascadia Code', 'Roboto Mono', monospace;
    font-weight: 500;
  }

  .prose :global(pre) {
    background: #0f172a;
    color: #e2e8f0;
    padding: 1.5rem;
    border-radius: 0.75rem;
    overflow-x: auto;
    margin: 2rem 0;
    border: 1px solid #334155;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .prose :global(pre code) {
    background: transparent;
    color: inherit;
    padding: 0;
    border-radius: 0;
    font-size: 0.875rem;
    line-height: 1.7;
  }

  /* Code block with language labels */
  .prose :global(pre[data-language]) {
    position: relative;
    padding-top: 3rem;
  }

  .prose :global(pre[data-language]::before) {
    content: attr(data-language);
    position: absolute;
    top: 0;
    left: 0;
    background: #334155;
    color: #cbd5e1;
    padding: 0.5rem 1rem;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-top-left-radius: 0.75rem;
    border-top-right-radius: 0.75rem;
    border-bottom-right-radius: 0.25rem;
  }

  /* Syntax highlighting for different languages */
  .prose :global(.token.comment),
  .prose :global(.token.prolog),
  .prose :global(.token.doctype),
  .prose :global(.token.cdata) {
    color: #6b7280;
    font-style: italic;
  }

  .prose :global(.token.punctuation) {
    color: #e2e8f0;
  }

  .prose :global(.token.property),
  .prose :global(.token.tag),
  .prose :global(.token.boolean),
  .prose :global(.token.number),
  .prose :global(.token.constant),
  .prose :global(.token.symbol),
  .prose :global(.token.deleted) {
    color: #fbbf24;
  }

  .prose :global(.token.selector),
  .prose :global(.token.attr-name),
  .prose :global(.token.string),
  .prose :global(.token.char),
  .prose :global(.token.builtin),
  .prose :global(.token.inserted) {
    color: #10b981;
  }

  .prose :global(.token.operator),
  .prose :global(.token.entity),
  .prose :global(.token.url),
  .prose :global(.language-css) .prose :global(.token.string),
  .prose :global(.style) .prose :global(.token.string) {
    color: #06b6d4;
  }

  .prose :global(.token.atrule),
  .prose :global(.token.attr-value),
  .prose :global(.token.keyword) {
    color: #8b5cf6;
  }

  .prose :global(.token.function),
  .prose :global(.token.class-name) {
    color: #f59e0b;
  }

  .prose :global(.token.regex),
  .prose :global(.token.important),
  .prose :global(.token.variable) {
    color: #ef4444;
  }

  /* Copy button for code blocks */
  .prose :global(pre) {
    position: relative;
  }

  .prose :global(.copy-code-button) {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: #374151;
    color: #d1d5db;
    border: 1px solid #4b5563;
    padding: 0.375rem 0.75rem;
    border-radius: 0.375rem;
    font-size: 0.75rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    opacity: 0.7;
  }

  .prose :global(.copy-code-button:hover) {
    background: #4b5563;
    opacity: 1;
  }

  .prose :global(.copy-code-button:active) {
    transform: scale(0.95);
  }

  /* Related Topics */
  .related-topics {
    border-left: 4px solid #6366f1;
  }

  .topic-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .topic-tag {
    background: rgba(99, 102, 241, 0.1);
    color: #6366f1;
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: 500;
  }

  /* Post Navigation */
  .post-navigation {
    text-align: center;
  }

  .back-to-blog {
    display: inline-block;
    padding: 0.75rem 2rem;
    background: transparent;
    color: #3730a3;
    border: 2px solid #3730a3;
    border-radius: 4px;
    text-decoration: none;
    font-weight: bold;
    text-transform: uppercase;
    font-size: 0.875rem;
    transition: all 0.3s ease;
  }

  .back-to-blog:hover {
    background: rgba(55, 48, 163, 0.1);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  /* Responsive Design */
  @media (max-width: 767px) {
    .post-title {
      font-size: 2rem;
    }

    .prose :global(h2) {
      font-size: 1.5rem;
    }

    .prose :global(p:first-of-type) {
      font-size: 1.125rem;
    }

    .prose :global(p),
    .prose :global(li) {
      font-size: 1rem;
    }

    .post-meta {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }

    .post-read-time::before {
      display: none;
    }

    .breadcrumb-list {
      flex-direction: column;
      align-items: flex-start;
    }

    .breadcrumb-list li:not(:last-child)::after {
      display: none;
    }
  }
</style>