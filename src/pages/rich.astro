<head>
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />

    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/MozillaReality/ammo.js@8bbc0ea/builds/ammo.wasm.js"></script>
    
    <script is:inline>
        let checkInterval; // Store the timeout ID

        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        function checkAFrame() {
            if (typeof AFRAME !== 'undefined') {
                clearTimeout(checkInterval); // Clear the timeout
                
                // Wait for scene to load
                const scene = document.querySelector('a-scene');
                if (scene.hasLoaded) {
                    initializeScene(scene);
                } else {
                    scene.addEventListener('loaded', () => initializeScene(scene));
                }
            } else {
                checkInterval = setTimeout(checkAFrame, 100); // Store the timeout ID
                console.log("waiting for aframe");
            }
        }

        function initializeScene(scene) {
            // Check if renderer exists and is ready
            if (scene.renderer && scene.renderer.xr) {
                scene.renderer.useLegacyLights = false;
                
                // Load physics system first, then pinboard
                loadScript('/aframe-physics-system.min.js')
                    .then(() => loadScript('/pinboard.js'))
                    .catch(console.error);
            } else {
                // If renderer isn't ready, wait a bit and try again
                setTimeout(() => initializeScene(scene), 100);
            }
        }

        checkAFrame();
    </script>
</head>

<div id="container" data-theme="valentine" style="touch-action: none;">
  <div class="text-overlay">
      <p>Performance Benchmark Test for Ammo</p>
    </div>
    <a class="code-link"
      target="_blank"
      href="https://github.com/c-frame/aframe-physics-system/blob/main/examples/ammo/perf.html">
      view code
    </a>
    <a-scene physics="driver: ammo; stats: panel"
             stats
             tick-time-display="sceneOutputEl: #tickTimerScene">
        <a-entity id="pinboard" pinboard="physics: ammo; height:20; width: 20" position = "0 0 -20" rotation = "45 0 0">
        </a-entity>
        <a-entity id="ball-recycler" ball-recycler="physics: ammo; ballCount: 100; width: 15; depth: 15; yKill: -8" position="0 8 -20">
        </a-entity>
        <a-plane id="tickTimerScene"
          position="0 15 -30"
          width="30"
          height="10"
          color="black"
          text="hi">
        </a-plane>
    </a-scene>
</div>
