---
// Hero slideshow component with dots and auto-advance
import { landingCopy, activeTheme } from '../config/theme';
const { children } = Astro.props;
const copy = landingCopy[activeTheme];
---

<div class="relative group w-full hero-slideshow">
    <div class="absolute w-full h-full z-10">
        <div
            id="slide-1-content"
            class="flex flex-col w-full h-full items-center justify-center pt-40 md:pt-48 text-[#fff2de]"
            style="display: none; background: linear-gradient(rgba(255, 255, 255, 0), rgba(0, 0, 0, 0.75));"
        >
            <h1 class="text-3xl md:text-6xl lg:text-[132px] text-center font-boogaloo">
                {copy.slide1.headline}
            </h1>
            <div class="flex flex-nowrap gap-6">
                <a
                    href={copy.slide1.ctaLink}
                    class="text-nowrap font-raleway font-bold md:text-4xl tracking-widest border-white border-[4px] hover:bg-white/20 mt-2 md:mt-16 p-2 transition-all duration-300 transform hover:scale-105 z-10 rounded-xl flex-1"
                > 
                    {copy.slide1.ctaLabel}
                </a>
                {copy.slide1.secondaryCtaLabel && (
                    <a
                        href={copy.slide1.secondaryCtaLink}
                        class="ftext-nowrap ont-raleway font-bold md:text-4xl tracking-widest border-white border-[4px] hover:bg-white/20 mt-2 md:mt-16 p-2 transition-all duration-300 transform hover:scale-105 z-10 rounded-xl flex-1"
                    >
                        {copy.slide1.secondaryCtaLabel}
                    </a>
                )}
            </div>
        </div>
        <div
            id="slide-2-content"
            class="flex flex-col w-full h-full items-start justify-center px-8 md:px-16 lg:px-24"
            style="display: flex; background: linear-gradient(to right, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0));"
        >
            <h1 class="text-4xl text-white md:text-6xl lg:text-7xl text-left font-boogaloo leading-tight whitespace-pre-line">
                {copy.slide2.headline}
            </h1>
            {copy.slide2.description && (
                <p class="font-raleway text-xl md:text-2xl italic font-light text-white mt-4 max-w-md">
                    {copy.slide2.description}
                </p>
            )}
            <a
                href={copy.slide2.ctaLink}
                class="text-nowrap font-raleway font-bold md:text-4xl text-white tracking-widest border-white border-[4px] hover:bg-white/20 mt-6 md:mt-8 p-2 transition-all duration-300 transform hover:scale-105 z-10 rounded-xl"
            >
                {copy.slide2.ctaLabel}
            </a>
        </div>
        <div
            id="slide-3-content"
            class="flex flex-col w-full h-full items-start justify-center px-8 md:px-16 lg:px-24"
            style="display: none; background: linear-gradient(to right, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0));"
        >
            <h1 class="text-4xl text-white md:text-6xl lg:text-7xl text-left font-boogaloo leading-tight whitespace-pre-line">
                {copy.slide3.headline}
            </h1>
            {copy.slide3.description && (
                <p class="font-raleway text-xl md:text-2xl font-light text-white mt-4 max-w-lg">
                    {copy.slide3.description}
                </p>
            )}
            <a
                href={copy.slide3.ctaLink}
                class="text-nowrap font-raleway font-bold md:text-4xl text-white tracking-widest border-white border-[4px] hover:bg-white/20 mt-6 md:mt-8 p-2 transition-all duration-300 transform hover:scale-105 z-10 rounded-xl"
            >
                {copy.slide3.ctaLabel}
            </a>
        </div>
    </div>
    <div
        class="hero-carousel bg-transparent w-full h-[50vh] md:h-screen relative overflow-hidden shadow-2xl"
    >
        <img
            src="/landing/landing_1.webp"
            alt="Halloween Pumpkin Sweater on model"
            class="hero-slide w-full h-full object-cover shadow-2xl absolute inset-0"
            data-index="1"
            style="display: none;"
        />
        <img
            src="/landing/landing_2.webp"
            alt="Halloween Pumpkin Sweaters Product"
            class="hero-slide w-full h-full object-cover shadow-2xl absolute inset-0 transition-opacity duration-500"
            data-index="2"
            style="display: block;"
        />
        <img
            src="/landing/landing_3.webp"
            alt="Halloween Bandana Alternative"
            class="hero-slide w-full h-full object-cover shadow-2xl absolute inset-0"
            data-index="3"
            style="display: none;"
        />
    </div>

    <!-- Overlaid content -->
    {children}

    <!-- Dots navigation -->
    <div
        class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex justify-center space-x-2 z-30"
    >
        <button
            class="hero-dot w-1 h-1 md:w-3 md:h-3 rounded-full bg-white/50 hover:bg-white/80 transition-all duration-300 active"
            data-slide="1"></button>
        <button
            class="hero-dot w-1 h-1 md:w-3 md:h-3 rounded-full bg-white/50 hover:bg-white/80 transition-all duration-300"
            data-slide="2"></button>
        <button
            class="hero-dot w-1 h-1 md:w-3 md:h-3 rounded-full bg-white/50 hover:bg-white/80 transition-all duration-300"
            data-slide="3"></button>
    </div>
</div>

<script>
    const slideshow = document.querySelector(".hero-slideshow");
    const carousel = slideshow?.querySelector(".hero-carousel");
    const slides = carousel?.querySelectorAll(".hero-slide");
    const dots = document.querySelectorAll(".hero-dot");

    if (slideshow && carousel && slides && dots) {
        let currentIndex = 1;
        const maxIndex = slides.length;
        let autoAdvanceInterval: number | null = null;

        showSlide(currentIndex);

        function showSlide(index: number) {
            // Hide all slides
            slides.forEach((slide) => {
                (slide as HTMLElement).style.display = "none";
            });

            // Hide all overlay content
            const slide1Content = document.getElementById("slide-1-content");
            const slide2Content = document.getElementById("slide-2-content");
            const slide3Content = document.getElementById("slide-3-content");
            if (slide1Content) slide1Content.style.display = "none";
            if (slide2Content) slide2Content.style.display = "none";
            if (slide3Content) slide3Content.style.display = "none";

            // Update dots
            dots.forEach((dot, i) => {
                if (i + 1 === index) {
                    dot.classList.add("active", "bg-white/80");
                    dot.classList.remove("bg-white/50");
                } else {
                    dot.classList.remove("active", "bg-white/80");
                    dot.classList.add("bg-white/50");
                }
            });

            // Show target slide
            const targetSlide = carousel.querySelector(
                `[data-index="${index}"]`,
            );
            if (targetSlide) {
                (targetSlide as HTMLElement).style.display = "block";
            }

            // Show corresponding overlay content
            if (index === 1 && slide1Content) {
                slide1Content.style.display = "flex";
            } else if (index === 2 && slide2Content) {
                slide2Content.style.display = "flex";
            } else if (index === 3 && slide3Content) {
                slide3Content.style.display = "flex";
            }
        }

        function nextSlide() {
            currentIndex = currentIndex === maxIndex ? 1 : currentIndex + 1;
            showSlide(currentIndex);
        }

        function goToSlide(index: number) {
            currentIndex = index;
            showSlide(currentIndex);
            // Reset auto-advance timer
            if (autoAdvanceInterval) {
                window.clearInterval(autoAdvanceInterval);
            }
            startAutoAdvance();
        }

        function startAutoAdvance() {
            //autoAdvanceInterval = window.setInterval(nextSlide, 4000); // 4 second intervals
        }

        // Add click event listeners to dots
        dots.forEach((dot, index) => {
            dot.addEventListener("click", () => {
                goToSlide(index + 1);
            });
        });

        // Add touch swipe support
        let touchStartX = 0;
        let touchEndX = 0;

        slideshow.addEventListener(
            "touchstart",
            (e: TouchEvent) => {
                touchStartX = e.changedTouches[0].screenX;
                // Do not prevent default here to allow taps on links/buttons to work on mobile
            },
            { passive: true },
        );

        slideshow.addEventListener(
            "touchend",
            (e: TouchEvent) => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
                // Do not prevent default here so that tap-generated click events can fire
            },
            { passive: true },
        );

        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchEndX - touchStartX;

            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    // Swipe right, go to previous
                    const prevIndex =
                        currentIndex === 1 ? maxIndex : currentIndex - 1;
                    goToSlide(prevIndex);
                } else {
                    // Swipe left, go to next
                    nextSlide();
                }
            }
        }

        // Pause auto-advance on hover
        slideshow.addEventListener("mouseenter", () => {
            if (autoAdvanceInterval) {
                window.clearInterval(autoAdvanceInterval);
                autoAdvanceInterval = null;
            }
        });

        slideshow.addEventListener("mouseleave", () => {
            startAutoAdvance();
        });

        // Start auto-advance
        startAutoAdvance();
    }
</script>

<style>
    .hero-dot.active {
        transform: scale(1.2);
        background-color: rgba(255, 255, 255, 0.9) !important;
    }

    .hero-slideshow:hover .hero-dot {
        opacity: 1;
    }
</style>
