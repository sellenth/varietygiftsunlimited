---
import ImageCarousel from './ImageCarousel.astro';
import { categories } from '../data/categories';

const { title, description, priceIds, singlePrice, singlePriceId, images, colorImages, price, disabled = false, category } = Astro.props;

// Get category display name
const categoryData = categories.find(cat => cat.id === category);
const categoryName = categoryData ? categoryData.name : category;

// Check if this is a color/size variant product (has colorImages defined)
const isColorSizeVariant = colorImages && Object.keys(colorImages).length > 0;
const colorOptions = isColorSizeVariant ? Object.keys(colorImages) : [];

// Use first color's images as default if color variants exist
const displayImages = isColorSizeVariant && colorOptions.length > 0 ? colorImages[colorOptions[0]] : images;

// Get the API key from environment variables
const PUBLIC_STRIPE_KEY = import.meta.env.PUBLIC_STRIPE_KEY;

const slugify = (value: string) => value
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, '-')
    .replace(/^-+|-+$/g, '')
    .slice(0, 40);

const checkoutClientReference = typeof title === "string" && title.length > 0 ? slugify(title) : undefined;

// Calculate sizes for template use
const availableSizes = priceIds ? Object.keys(priceIds) : [];
const defaultSize = availableSizes.length > 0 ? availableSizes[0] : null;
const sizeOptions = isColorSizeVariant ? [...new Set(availableSizes.map(s => s.split(' - ')[1]))] : availableSizes;
---

<div class="max-w-6xl mx-auto px-4 py-8">
    <!--
    <button onclick="window.history.length > 1 ? history.back() : window.location.href = '/'" class="inline-block mb-6 text-gray-600 hover:text-gray-900 transition-colors">
        <span class="flex items-center gap-1">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
            Back
        </span>
    </button> -->
    <div class="grid md:grid-cols-2 gap-8 pt-12">
        <ImageCarousel images={displayImages} title={title} />
        <div class="flex flex-col gap-4">
            <nav class="text-sm text-gray-500 mb-2">
                <a href="/shop" class="hover:text-gray-700">All</a>
                <span class="mx-2">></span>
                <a href={`/shop/category/${category}`} class="hover:text-gray-700">{categoryName}</a>
                <span class="mx-2">></span>
                <span class="text-gray-900">{title}</span>
            </nav>
            <h1 class="text-3xl font-bold">{title}</h1>
            <p class="text-gray-600">{description}</p>

{priceIds ? (
                <div class="space-y-4">
                    <p class="text-xl font-semibold">{price || '$19.99'} w/ free shipping!</p>
                    {isColorSizeVariant ? (
                        <>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-3">
                                    Select Color:
                                </label>
                                <div class="flex gap-3 flex-wrap">
                                    {colorOptions.map((color, index) => {
                                        const colorMap = {
                                            'Green': '#6b8671',
                                            'Pink': '#eec6d8',
                                            'Natural': '#f5f5dc',
                                            'Yellow': '#fbbf24',
                                            'Blue': '#3b82f6',
                                            'Purple': '#a855f7',
                                            'Red': '#804f54',
                                            'Black': '#000000',
                                            'White': '#ffffff',
                                            'Ivory': '#fffff0',
                                            'Cream': '#f6f0e0',
                                            'Gray': '#6b7280',
                                            'Grey': '#6b7280',
                                            'Brown': '#8b4513',
                                            'Espresso': '#4b3621',
                                            'Dark Gray': '#555651',
                                            'Tan': '#d2b48c',
                                            'Olive': '#6b8e23',
                                            'Orange': '#f97316',
                                            'Denim': '#4f5364',
                                            'Seafoam': '#6ba6a4',
                                            'Pepper': '#5e5f5a'
                                        };
                                        const bgColor = colorMap[color] || '#e5e7eb';
                                        const isLight = color === 'Natural' || color === 'White' || color === 'Yellow' || color === 'Tan' || color === 'Ivory' || color === 'Cream';
                                        return (
                                            <button
                                                type="button"
                                                data-color={color}
                                                class={`color-orb ${index === 0 ? 'active' : ''}`}
                                                style={`background-color: ${bgColor};`}
                                                aria-label={`Select ${color} color`}
                                            >
                                                <span class="color-name">{color}</span>
                                                {isLight && <span class="orb-border"></span>}
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>
                            <div>
                                <label for="size-select" class="block text-sm font-medium text-gray-700 mb-2">
                                    Select Size:
                                </label>
                                <select 
                                    id="size-select" 
                                    name="size" 
                                    class="block w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                                >
                                    {sizeOptions.map((size) => (
                                        <option value={size}>{size}</option>
                                    ))}
                                </select>
                            </div>
                        </>
                    ) : (
                        <div>
                            <label for="size-select" class="block text-sm font-medium text-gray-700 mb-2">
                                Select Size:
                            </label>
                            <select 
                                id="size-select" 
                                name="size" 
                                class="block w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                            >
                                {availableSizes.map((size) => (
                                    <option value={priceIds[size]} selected={size === defaultSize}>{size}</option>
                                ))}
                            </select>
                        </div>
                    )}
                    {disabled ? (
                        <>
                            <button 
                                class="w-full bg-gray-300 text-gray-600 py-3 px-6 rounded-md cursor-not-allowed"
                                disabled
                                aria-disabled="true"
                            >
                                Unavailable
                            </button>
                            <p class="text-sm text-center text-gray-500">This item is currently unavailable.</p>
                        </>
                    ) : (
                        <>
                            <button 
                                id="buy-button"
                                data-stripe-key={PUBLIC_STRIPE_KEY}
                                data-stripe-payment-id={priceIds[defaultSize]}
                                data-is-color-size={isColorSizeVariant}
                                data-client-reference-id={checkoutClientReference || undefined}
                                class="w-full bg-indigo-600 text-white py-3 px-6 rounded-md hover:bg-indigo-700 transition-colors"
                            >
                                Buy Now
                            </button>
                            <p class="text-sm text-center text-gray-500">Powered by Stripe • 30 day money back guarantee</p>
                        </>
                    )}
                </div>
            ) : (
                <div class="space-y-4">
                    <p class="text-xl font-semibold">{price || `$${singlePrice}`} w/ free shipping!</p>
                    {disabled ? (
                        <>
                            <button 
                                class="w-full bg-gray-300 text-gray-600 py-3 px-6 rounded-md cursor-not-allowed"
                                disabled
                                aria-disabled="true"
                            >
                                Unavailable
                            </button>
                            <p class="text-sm text-center text-gray-500">This item is currently unavailable.</p>
                        </>
                    ) : (
                        <>
                            <button 
                                id="buy-button"
                                data-stripe-key={PUBLIC_STRIPE_KEY}
                                data-stripe-payment-id={singlePriceId}
                                data-client-reference-id={checkoutClientReference || undefined}
                                class="w-full bg-indigo-600 text-white py-3 px-6 rounded-md hover:bg-indigo-700 transition-colors"
                            >
                                Buy Now
                            </button>
                            <p class="text-sm text-center text-gray-500">Powered by Stripe • 30 day money back guarantee</p>
                        </>
                    )}
                </div>
            )}
        </div>
    </div>

    <div class="mt-16 border-t border-gray-200 pt-12">
        <div class="max-w-4xl mx-auto space-y-6">
            <details class="policy-section">
                <summary class="policy-header">
                    <span class="policy-title">Shipping Policy</span>
                    <svg class="policy-chevron" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </summary>
                <div class="policy-content">
                    <div class="policy-item">
                        <h3 class="policy-subtitle">Processing Time:</h3>
                        <p class="policy-text">All orders are made to order and processed within 3–5 business days. Once shipped, you'll receive a confirmation email with tracking details.</p>
                    </div>
                    
                    <div class="policy-item">
                        <h3 class="policy-subtitle">Shipping Destinations:</h3>
                        <p class="policy-text">We ship both within the U.S. and internationally. Delivery times vary by location and local postal services.</p>
                    </div>
                    
                    <div class="policy-item">
                        <h3 class="policy-subtitle">Estimated Delivery:</h3>
                        <ul class="policy-list">
                            <li><strong>U.S. Orders:</strong> 5–10 business days after processing</li>
                            <li><strong>International Orders:</strong> 10–21 business days after processing</li>
                        </ul>
                    </div>
                    
                    <div class="policy-item">
                        <h3 class="policy-subtitle">Customs & Import Taxes:</h3>
                        <p class="policy-text">International customers are responsible for any customs duties or import fees applied by their country.</p>
                    </div>
                </div>
            </details>

            <details class="policy-section">
                <summary class="policy-header">
                    <span class="policy-title">Return & Refund Policy</span>
                    <svg class="policy-chevron" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </summary>
                <div class="policy-content">
                    <p class="policy-text mb-6">We want you to love your purchase! If you're not completely satisfied, we gladly accept returns and exchanges within 14 days of delivery.</p>
                    
                    <div class="policy-item">
                        <h3 class="policy-subtitle">Eligibility:</h3>
                        <ul class="policy-list">
                            <li>Items must be unused, unworn, and in their original packaging.</li>
                            <li>Contact us at <a href="mailto:hello@variety.gifts" class="policy-link">hello@variety.gifts</a> before returning your order to receive instructions.</li>
                        </ul>
                    </div>
                    
                    <div class="policy-item">
                        <h3 class="policy-subtitle">Non-Returnable Items:</h3>
                        <ul class="policy-list">
                            <li>Personalized or custom-made gifts</li>
                            <li>Items returned without prior approval</li>
                        </ul>
                    </div>
                    
                    <div class="policy-item">
                        <h3 class="policy-subtitle">Refunds & Exchanges:</h3>
                        <ul class="policy-list">
                            <li>If your item arrives damaged, defective, or incorrect, we'll replace it or issue a refund at no cost.</li>
                            <li>If you'd like to return an item for another reason (such as size or change of mind), return shipping costs are the responsibility of the customer.</li>
                        </ul>
                        <p class="policy-text mt-3">Refunds will be processed to your original payment method once the returned item is received and inspected.</p>
                    </div>
                    
                    <div class="policy-item">
                        <h3 class="policy-subtitle">Contact Us:</h3>
                        <p class="policy-text">If you have questions about your order, email us at <a href="mailto:hello@variety.gifts" class="policy-link">hello@variety.gifts</a> — we're always happy to help!</p>
                    </div>
                </div>
            </details>
        </div>
    </div>
</div>


<script>
    const buyButton = document.getElementById("buy-button") as HTMLButtonElement | null;
    const sizeSelect = document.getElementById("size-select") as HTMLSelectElement | null;
    const isColorSize = buyButton?.dataset?.isColorSize === "true";
    const CHECKOUT_ENDPOINT = "/shop/checkout";
    const SHIPPING_COUNTRIES = ["US","CN","DE","JP","IN","GB","FR","IT","BR","CA","RU","MX","KR","AU","ES","ID","NL","SA","TR","CH","TW","PL","TH","SE","BE"];
    
    let stripe: any = null;
    let stripeLoadError = false;
    const isDev = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';

    // Only load Stripe in production
    if (!isDev) {
        const { loadStripe } = await import("@stripe/stripe-js");
        
        // Initialize Stripe if configuration is available
        if (buyButton?.dataset?.stripeKey && buyButton?.dataset?.stripePaymentId) {
            const stripeKey = buyButton.dataset.stripeKey;
            try {
                stripe = await loadStripe(stripeKey);
                if (!stripe) {
                    console.error("Failed to initialize Stripe.");
                    stripeLoadError = true;
                }
            } catch (error) {
                console.error("Error loading Stripe:", error);
                stripeLoadError = true;
            }
        } else {
            console.error("Missing required Stripe configuration");
            stripeLoadError = true;
        }
    } else {
        console.log("Stripe disabled in development mode");
        stripeLoadError = true;
    }

    // For color/size variants, find the price ID based on selection
    const getPriceId = () => {
        if (isColorSize && sizeSelect) {
            const activeOrb = document.querySelector('.color-orb.active');
            const color = activeOrb?.getAttribute('data-color') || '';
            const size = sizeSelect.value;
            const key = `${color} - ${size}`;
            // Get price IDs from the page's script data
            const priceData = (window as any).priceIds || {};
            return priceData[key] || buyButton?.dataset?.stripePaymentId;
        }
        return sizeSelect ? sizeSelect.value : buyButton?.dataset?.stripePaymentId;
    };

    const createCheckoutSession = async (priceId: string) => {
        if (!priceId) {
            throw new Error("Missing price selection.");
        }

        const endpointUrl = new URL(CHECKOUT_ENDPOINT, window.location.origin).toString();
        const payload = {
            priceId,
            successUrl: `${window.location.origin}/success`,
            cancelUrl: window.location.href,
            shippingCountries: SHIPPING_COUNTRIES,
            clientReferenceId: buyButton?.dataset?.clientReferenceId || window.location.pathname
        };

        const response = await fetch(endpointUrl, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(payload)
        });

        let data: any = null;
        try {
            data = await response.json();
        } catch (error) {
            console.error("Failed to parse checkout response:", error);
            throw new Error("Unexpected response from checkout service.");
        }

        if (!response.ok) {
            throw new Error(data?.error || "Unable to start checkout. Please try again.");
        }

        if (!data?.sessionId) {
            throw new Error("Checkout session response missing sessionId.");
        }

        return data.sessionId as string;
    };

    const setProcessingState = (isProcessing: boolean) => {
        if (!buyButton) return;
        if (isProcessing) {
            buyButton.dataset.originalLabel = buyButton.textContent || "Buy Now";
            buyButton.textContent = "Processing...";
            buyButton.disabled = true;
        } else {
            buyButton.textContent = buyButton.dataset.originalLabel || "Buy Now";
            buyButton.disabled = false;
        }
    };

    // Initialize carousel functionality
    function initializeCarousel() {
        const carousel = document.querySelector('.carousel');
        const items = carousel?.querySelectorAll('.carousel-item');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        
        if (carousel && items && prevBtn && nextBtn) {
            let currentIndex = 1;
            const maxIndex = items.length;

            // Hide navigation buttons if there's only one image
            if (maxIndex <= 1) {
                prevBtn.style.display = 'none';
                nextBtn.style.display = 'none';
            } else {
                prevBtn.style.display = '';
                nextBtn.style.display = '';
            }

            function showImage(index: number) {
                items.forEach((item) => {
                    item.classList.add('hidden');
                });
                const targetItem = carousel.querySelector(`[data-index="${index}"]`);
                if (targetItem) {
                    targetItem.classList.remove('hidden');
                }
            }

            function nextImage() {
                currentIndex = currentIndex === maxIndex ? 1 : currentIndex + 1;
                showImage(currentIndex);
            }

            function prevImage() {
                currentIndex = currentIndex === 1 ? maxIndex : currentIndex - 1;
                showImage(currentIndex);
            }

            // Remove existing listeners before adding new ones
            const newPrevBtn = prevBtn.cloneNode(true);
            const newNextBtn = nextBtn.cloneNode(true);
            prevBtn.parentNode?.replaceChild(newPrevBtn, prevBtn);
            nextBtn.parentNode?.replaceChild(newNextBtn, nextBtn);

            // Add click event listeners to the buttons
            newNextBtn.addEventListener('click', (e) => {
                e.preventDefault();
                nextImage();
            });
            
            newPrevBtn.addEventListener('click', (e) => {
                e.preventDefault();
                prevImage();
            });
        }
    }

    // Handle color selection changes
    function setupColorImageSwitching() {
        const colorOrbs = document.querySelectorAll('.color-orb');
        let currentColor = colorOrbs[0]?.getAttribute('data-color') || '';
        
        if (colorOrbs.length > 0 && (window as any).colorImages) {
            colorOrbs.forEach(orb => {
                orb.addEventListener('click', () => {
                    const selectedColor = orb.getAttribute('data-color') || '';
                    if (selectedColor === currentColor) return;
                    
                    // Update active state
                    colorOrbs.forEach(o => o.classList.remove('active'));
                    orb.classList.add('active');
                    currentColor = selectedColor;
                    
                    const colorImagesData = (window as any).colorImages[selectedColor];
                    
                    if (colorImagesData) {
                        const carousel = document.querySelector('.carousel');
                        const existingImages = carousel?.querySelectorAll('.carousel-item');
                        
                        if (carousel && existingImages) {
                            // Fade out current images
                            existingImages.forEach(img => {
                                img.classList.add('opacity-0', 'transition-opacity', 'duration-200');
                            });
                            
                            setTimeout(() => {
                                // Remove existing images
                                existingImages.forEach(img => img.remove());
                                
                                // Add new images for the selected color
                                colorImagesData.forEach((image: any, index: number) => {
                                    const img = document.createElement('img');
                                    img.src = image.src;
                                    img.alt = image.alt;
                                    img.loading = index === 0 ? "eager" : "lazy";
                                    img.className = `w-full h-full object-cover carousel-item select-none opacity-0 transition-opacity duration-200 ${index === 0 ? '' : 'hidden'}`;
                                    img.setAttribute('data-index', (index + 1).toString());
                                    carousel.appendChild(img);
                                    
                                    // Fade in new images
                                    setTimeout(() => {
                                        img.classList.remove('opacity-0');
                                    }, 50);
                                });
                                
                                // Reset carousel counter
                                const counter = carousel.parentElement?.querySelector('.carousel-counter');
                                if (counter) {
                                    counter.textContent = `1 / ${colorImagesData.length}`;
                                }
                                
                                // Reinitialize carousel functionality
                                initializeCarousel();
                            }, 200);
                        }
                    }
                });
            });
        }
    }

    // Setup color switching after DOM is loaded
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setupColorImageSwitching);
    } else {
        setupColorImageSwitching();
    }

    // Only add click handler if buy button exists
    if (buyButton) {
        buyButton.addEventListener("click", async () => {
            if (isDev) {
                alert("Stripe checkout is disabled in development mode.");
                return;
            }
            
            if (stripeLoadError || !stripe) {
                alert("Payment system is currently unavailable. Please try again later.");
                return;
            }

            const priceId = getPriceId();

            if (!priceId) {
                alert("Please select a valid option before checking out.");
                return;
            }

            setProcessingState(true);

            try {
                const sessionId = await createCheckoutSession(priceId);
                const result = await stripe.redirectToCheckout({ sessionId });

                if (result && result.error) {
                    console.error("Stripe checkout failed:", result.error);
                    alert(result.error.message || "Checkout failed. Please try again.");
                }
            } catch (error) {
                console.error("Checkout session creation failed:", error);
                const message = error instanceof Error ? error.message : "Unable to start checkout. Please try again.";
                alert(message);
            } finally {
                setProcessingState(false);
            }
        });
    }
</script>

<style>
    .color-orb {
        position: relative;
        width: 48px;
        height: 48px;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        transform: scale(1);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }
    
    .color-orb:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .color-orb:active {
        transform: scale(0.95);
    }
    
    .color-orb.active {
        transform: scale(1.1);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2), 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .color-orb.active::after {
        content: '✓';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 20px;
        font-weight: bold;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }
    
    .color-orb.active[data-color="Natural"]::after,
    .color-orb.active[data-color="White"]::after,
    .color-orb.active[data-color="Yellow"]::after,
    .color-orb.active[data-color="Tan"]::after,
    .color-orb.active[data-color="Ivory"]::after {
        color: #374151;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }
    
    .color-name {
        position: absolute;
        bottom: -24px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 12px;
        color: #6b7280;
        white-space: nowrap;
        opacity: 0;
        transition: opacity 0.2s ease-in-out;
        pointer-events: none;
    }
    
    .color-orb:hover .color-name {
        opacity: 1;
    }
    
    .orb-border {
        position: absolute;
        inset: 0;
        border-radius: 50%;
        border: 1px solid rgba(0, 0, 0, 0.1);
        pointer-events: none;
    }
    
    /* Ripple effect on click */
    @keyframes ripple {
        0% {
            transform: scale(0);
            opacity: 0.8;
        }
        100% {
            transform: scale(4);
            opacity: 0;
        }
    }
    
    .color-orb::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.5);
        transform: translate(-50%, -50%);
    }
    
    .color-orb:active::before {
        width: 100%;
        height: 100%;
        animation: ripple 0.6s ease-out;
    }
    
    .policy-section {
        border: 1px solid #e5e7eb;
        border-radius: 0.5rem;
        background: #ffffff;
        overflow: hidden;
        transition: all 0.2s ease-in-out;
    }
    
    .policy-section:hover {
        border-color: #d1d5db;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .policy-section[open] {
        border-color: #6366f1;
        box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.1);
    }
    
    .policy-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 1.25rem 1.5rem;
        cursor: pointer;
        list-style: none;
        user-select: none;
        transition: background-color 0.2s ease-in-out;
    }
    
    .policy-header::-webkit-details-marker {
        display: none;
    }
    
    .policy-header:hover {
        background-color: #f9fafb;
    }
    
    .policy-section[open] .policy-header {
        background-color: #f9fafb;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .policy-icon {
        font-size: 1.5rem;
        line-height: 1;
        flex-shrink: 0;
    }
    
    .policy-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: #111827;
        flex: 1;
    }
    
    .policy-chevron {
        width: 1.25rem;
        height: 1.25rem;
        color: #6b7280;
        transition: transform 0.2s ease-in-out;
        flex-shrink: 0;
    }
    
    .policy-section[open] .policy-chevron {
        transform: rotate(180deg);
    }
    
    .policy-content {
        padding: 1.5rem;
        padding-top: 1.5rem;
    }
    
    .policy-item {
        margin-bottom: 1.5rem;
    }
    
    .policy-item:last-child {
        margin-bottom: 0;
    }
    
    .policy-subtitle {
        font-size: 1rem;
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.5rem;
    }
    
    .policy-text {
        font-size: 0.9375rem;
        line-height: 1.6;
        color: #4b5563;
    }
    
    .policy-list {
        list-style: none;
        padding: 0;
        margin: 0.5rem 0;
    }
    
    .policy-list li {
        font-size: 0.9375rem;
        line-height: 1.6;
        color: #4b5563;
        padding-left: 1.5rem;
        position: relative;
        margin-bottom: 0.5rem;
    }
    
    .policy-list li:last-child {
        margin-bottom: 0;
    }
    
    .policy-list li::before {
        content: '•';
        position: absolute;
        left: 0.5rem;
        color: #6366f1;
        font-weight: bold;
    }
    
    .policy-link {
        color: #6366f1;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.2s ease-in-out;
    }
    
    .policy-link:hover {
        color: #4f46e5;
        text-decoration: underline;
    }
    
    @media (max-width: 640px) {
        .policy-header {
            padding: 1rem;
        }
        
        .policy-content {
            padding: 1rem;
        }
        
        .policy-title {
            font-size: 1rem;
        }
        
        .policy-icon {
            font-size: 1.25rem;
        }
        
        .policy-subtitle {
            font-size: 0.9375rem;
        }
        
        .policy-text,
        .policy-list li {
            font-size: 0.875rem;
        }
    }
</style> 
